<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hotlink Builder</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;margin:16px;max-width:980px}
  h1{font-size:22px;margin:0 0 6px}
  .small{color:#666;font-size:13px}
  .card{border:1px solid #ddd;border-radius:10px;padding:12px;margin-top:12px}
  .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
  input,button{font-size:16px;padding:10px;border-radius:8px;border:1px solid #ccc}
  button{cursor:pointer;background:#f5f5f5}
  button:hover{background:#eee}
  .addWrap{text-align:center;margin-top:10px}
  .contacts{display:grid;gap:10px;margin-top:10px}
  .contact{border:1px solid #eee;border-radius:10px;padding:10px}
  .contact-head{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .name{font-weight:800}
  .num{color:#555;font-variant-numeric:tabular-nums}
  .btns{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
  a.action{text-decoration:none;border:1px solid #ccc;padding:8px 12px;border-radius:8px;color:#000;background:#f9f9f9}
  a.action:hover{background:#eee}
  /* red-tinted delete controls with black text */
  .danger{border:1px solid #c33;background:#f4b6b6;color:#000}
  .danger:hover{background:#ee9e9e}
  .footer-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
</style>
</head>
<body>

<h1>Hotlink Builder</h1>
<div class="small">
  Add people here. Then download <b>hotlinks.html</b> and upload it to GitHub to update the public forwardable list.
</div>

<div class="card">
  <div class="row">
    <input id="first" placeholder="First Name">
    <input id="last"  placeholder="Last Name">
    <input id="phone" placeholder="Phone (e.g., 207-555-1234)" inputmode="tel">
  </div>

  <div class="addWrap">
    <button id="add">Add Person</button>
  </div>

  <div class="small" style="margin-top:8px;">
    Tip: Press <b>Enter</b> in the phone box to save and jump to the next person.
  </div>
</div>

<div class="card">
  <div style="font-weight:800;margin-bottom:6px;">People</div>
  <div id="preview" class="contacts"></div>

  <div class="footer-actions">
    <button id="download">Download Public Hotlinks Page (hotlinks.html)</button>
    <button id="clear" class="danger">Clear All</button>
  </div>

  <div class="small" style="margin-top:8px;">
    Forward this link to people (after you upload the new hotlinks.html):
    <br><b>/hotlinks/hotlinks.html</b>
  </div>
</div>

<script>
  const STORAGE = "hotlink_builder_contacts_v2";
  const $ = id => document.getElementById(id);

  function normalizePhone(input){
    input = (input||"").trim();
    const plus = input.startsWith("+") ? "+" : "";
    const digits = input.replace(/[^\d]/g,"");
    return digits ? plus + digits : "";
  }

  function prettyPhone(input){
    const d = (input||"").replace(/[^\d]/g,"");
    if(d.length===10) return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
    if(d.length===11 && d.startsWith("1")) return `+1 (${d.slice(1,4)}) ${d.slice(4,7)}-${d.slice(7)}`;
    return input;
  }

  function esc(s){
    return String(s??"")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  let contacts = [];
  try { contacts = JSON.parse(localStorage.getItem(STORAGE) || "[]"); } catch { contacts = []; }
  function save(){ localStorage.setItem(STORAGE, JSON.stringify(contacts)); }

  function fullName(c){
    return [c.first, c.last].map(x => (x||"").trim()).filter(Boolean).join(" ");
  }

  function add(){
    const first = $("first").value.trim();
    const last  = $("last").value.trim();
    const raw   = $("phone").value.trim();
    const norm  = normalizePhone(raw);

    if(!first || !norm){
      alert("Please enter at least a First Name and a valid phone number.");
      return;
    }

    contacts.push({ first, last, phone:norm, display: prettyPhone(raw) });
    save();

    $("first").value=""; $("last").value=""; $("phone").value="";
    $("first").focus();
    render();
  }

  function del(i){
    contacts.splice(i,1);
    save();
    render();
  }

  function render(){
    const p = $("preview");
    p.innerHTML = "";
    if(!contacts.length){
      p.innerHTML = `<div class="small">No people added.</div>`;
      return;
    }

    contacts.forEach((c,i) => {
      const div = document.createElement("div");
      div.className = "contact";
      div.innerHTML = `
        <div class="contact-head">
          <div>
            <div class="name">${esc(fullName(c) || "Unnamed")}</div>
            <div class="num">${esc(c.display)}</div>
          </div>
          <button class="danger" data-del="${i}">Remove</button>
        </div>
        <div class="btns">
          <a class="action" href="tel:${c.phone}">ðŸ“ž Call</a>
          <a class="action" href="sms:${c.phone}">ðŸ’¬ Text</a>
        </div>
      `;
      p.appendChild(div);
    });

    p.querySelectorAll("button[data-del]").forEach(btn => {
      btn.addEventListener("click", () => del(parseInt(btn.getAttribute("data-del"),10)));
    });
  }

  function buildPublicHotlinksHtml(list){
    const items = list.map(c => `
      <div class="person">
        <div class="nm">${esc(fullName(c) || "Unnamed")}</div>
        <div class="ph">${esc(c.display || "")}</div>
        <div class="buttons">
          <a class="button" href="tel:${esc(c.phone)}">ðŸ“ž Call</a>
          <a class="button" href="sms:${esc(c.phone)}">ðŸ’¬ Text</a>
        </div>
      </div>
    `).join("");

    return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hotlinks</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:#f6f6f6;margin:0;padding:20px}
  .container{max-width:700px;margin:auto;background:#fff;border-radius:14px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,0.08)}
  h1{text-align:center;margin:0 0 8px}
  .sub{text-align:center;color:#666;margin:0 0 18px}
  .person{border:1px solid #ddd;border-radius:12px;padding:14px;margin-bottom:12px}
  .nm{font-size:18px;font-weight:800}
  .ph{color:#666;margin-top:3px;margin-bottom:12px;font-variant-numeric:tabular-nums}
  .buttons{display:flex;gap:12px}
  .button{flex:1;text-align:center;padding:12px;border-radius:10px;border:1px solid #aaa;text-decoration:none;font-weight:700;color:#000;background:#f2f2f2}
  .button:hover{background:#e9e9e9}
</style>
</head>
<body>
<div class="container">
  <h1>Contact Hotlinks</h1>
  <div class="sub">Tap a button to call or text</div>
  ${items || `<div style="color:#666;text-align:center;">No contacts posted yet.</div>`}
</div>
</body>
</html>`;
  }

  function downloadPublic(){
    const html = buildPublicHotlinksHtml(contacts);
    const blob = new Blob([html], {type:"text/html"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "hotlinks.html";   // IMPORTANT: this is the public page file name
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  $("add").addEventListener("click", add);
  $("phone").addEventListener("keydown", (e) => { if(e.key==="Enter"){ e.preventDefault(); add(); }});
  $("download").addEventListener("click", downloadPublic);

  $("clear").addEventListener("click", () => {
    if(!confirm("Clear all people?")) return;
    contacts = [];
    save();
    render();
    $("first").focus();
  });

  render();
  $("first").focus();
</script>

</body>
</html>
